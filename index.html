<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PK768FJP');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Kloopik - Play free online games. Discover 700+ games across all genres: action, puzzle, racing, sports, and more!">
    <meta name="keywords" content="free games, online games, play games, browser games, HTML5 games">

    <!-- Security: Upgrade insecure requests to HTTPS -->
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Kloopik - Free Online Games">
    <meta property="og:description" content="Play 700+ free online games instantly in your browser!">
    <meta property="og:image" content="/assets/og-image.jpg">

    <!-- Prepared for future i18n -->
    <!-- <link rel="alternate" hreflang="en" href="https://kloopik.com/en/" /> -->
    <!-- <link rel="alternate" hreflang="es" href="https://kloopik.com/es/" /> -->

    <title>Kloopik - Free Online Games | Play 700+ Games</title>

    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://playgama.com">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/cookie-consent.css">
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PK768FJP"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Header Navigation -->
    <header class="header" id="header">
        <div class="container">
            <nav class="navbar">
                <div class="navbar-brand">
                    <a href="#/" class="logo">
                        <h1>KLOOPIK</h1>
                    </a>
                </div>

                <!-- Mobile Menu Toggle -->
                <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>

                <!-- Navigation Menu -->
                <div class="navbar-menu" id="navbarMenu">
                    <ul class="nav-links">
                        <li><a href="#/" class="nav-link active" data-category="all">All Games</a></li>
                        <li><a href="#/favorites" class="nav-link" data-page="favorites">Favorites</a></li>
                        <li><a href="#/recent" class="nav-link" data-page="recent">Recently Played</a></li>
                    </ul>

                    <!-- Search Bar -->
                    <div class="search-container">
                        <input
                            type="search"
                            id="searchInput"
                            class="search-input"
                            placeholder="Search games..."
                            aria-label="Search games"
                        >
                        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-content">
            <div class="sidebar-header">
                <svg class="sidebar-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                <span class="sidebar-title">Categories</span>
            </div>
            <nav class="sidebar-nav" id="sidebarNav">
                <!-- Category items will be dynamically inserted here -->
            </nav>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="content-wrapper">
            <!-- Games Section -->
            <section class="games-section" id="gamesSection">
                <div class="section-header" style="display: none;">
                    <h2 class="section-title" id="sectionTitle">All Games</h2>
                    <div class="games-count" id="gamesCount">Loading...</div>
                </div>

                <!-- Loading State -->
                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner"></div>
                    <p>Loading games...</p>
                </div>

                <!-- Category Rows Container -->
                <div class="category-rows" id="categoryRows">
                    <!-- Category rows will be dynamically inserted here -->
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <h3>No games found</h3>
                    <p>Try adjusting your search or filters</p>
                </div>
            </section>
        </div>
    </main>

    <!-- Game Modal -->
    <div class="game-modal" id="gameModal">
        <div class="game-modal-overlay" id="gameModalOverlay"></div>
        <div class="game-modal-content">
            <div class="game-modal-header">
                <h2 class="game-modal-title" id="gameModalTitle">Game Title</h2>
                <div class="game-modal-actions">
                    <button class="btn-icon" id="favoriteBtn" aria-label="Add to favorites" title="Add to favorites">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                        </svg>
                    </button>
                    <button class="btn-icon" id="fullscreenBtn" aria-label="Toggle fullscreen" title="Fullscreen">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                        </svg>
                    </button>
                    <button class="btn-close" id="closeModalBtn" aria-label="Close game" title="Close">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="game-modal-body">
                <div class="game-iframe-container" id="gameIframeContainer">
                    <iframe
                        id="gameIframe"
                        sandbox="allow-scripts allow-same-origin allow-popups allow-forms allow-pointer-lock"
                        allow="accelerometer; gyroscope; autoplay; encrypted-media; fullscreen"
                        referrerpolicy="no-referrer"
                        allowfullscreen
                        frameborder="0"
                    ></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2025 Kloopik. All rights reserved. | <a href="/privacy.html" style="color: #6366f1; text-decoration: underline;">Privacy Policy</a></p>
                <p class="footer-note">Games powered by <a href="https://playgama.com" target="_blank" rel="noopener">Playgama</a></p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <!-- Load sanitizer first for XSS prevention -->
    <script src="js/sanitizer.js"></script>
    <script src="js/cookie-consent.js"></script>
    <script src="js/analytics.js" defer></script>
    <script src="js/storage.js" defer></script>
    <script src="js/router.js" defer></script>
    <script src="js/games.js" defer></script>
    <script src="js/app.js" defer></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('[PWA] Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.error('[PWA] Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
